<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class GenerateBulanan extends AUTH_Controller {
	public function __construct() {
		parent::__construct();
		$this->load->model('M_profile');
		$this->load->model('M_tb_export_bulanan');
		$this->load->model('M_bulan');
		$this->load->model('M_unit_pembayar');
		$this->load->library('postingBulanan');
	}

	public function index() {
		$data['userdata'] 	= $this->userdata;
		$kd_satker 	= $data['userdata']->kd_satker;
		$tahun = year_app($kd_satker);
		$data['dataSatker'] = $this->M_profile->select_kd_satker();
		$data['dataJenis'] = ['Gaji', 'Gaji Rapel', 'Tukin', 'PPNPN'];
		$data['dataUnitKerja'] = $this->M_unit_pembayar->select_all();
		$data['dataBulan'] = $this->M_bulan->select_all();

		$data['page'] 		= "generate_bulanan";
		$data['judul'] 		= "Data Generate Bulanan";
		$data['deskripsi'] 	= "Manage Data Generate Bulanan";


		$this->template->views('generate_bulanan/home', $data);
	}

	public function tampil() {
		$data['userdata'] 	= $this->userdata;
		$kd_satker 	= $data['userdata']->kd_satker;
		$bulan = '';
		$jenis = '';
		$tahun = year_app($kd_satker);
		if(isset($_POST['jenis'])){
		    $jenis = $_POST['jenis'];
		}
		if(isset($_POST['bulan'])){
		    $bulan = $_POST['bulan'];
		}
		$data['data_export_bulanan'] = $this->M_tb_export_bulanan->select_by_jenis($kd_satker,$tahun,$bulan,$jenis);
		$this->load->view('generate_bulanan/list_data', $data);
	}

	public function lihat() {
        $data = $this->input->post();
        $this->session->set_flashdata('msg', show_succ_msg('Set Jenis Penghasilan Berhasil', '20px'));
        redirect('GenerateBulanan?jenis='.$data['jenis'].'&bulan='.$data['bulan'].'&unit='.$data['unit_kerja'],'refresh');
	}

	public function posting() {
		$data['userdata'] 	= $this->userdata;
		$kd_satker 	= $data['userdata']->kd_satker;
		$tahun = year_app($kd_satker);
		if(isset($_POST['jenis'])){
		    $jenis = $_POST['jenis'];
		}else{
		    $this->session->set_flashdata('msg', show_succ_msg('Mohon Pilih Jenis Terlebih Dahulu', '20px'));
		    redirect('GenerateBulanan','refresh');
		}
		if(isset($_POST['bulan'])){
		    $bulan = $_POST['bulan'];
		}else{
		    $this->session->set_flashdata('msg', show_succ_msg('Mohon Pilih Bulan Terlebih Dahulu', '20px'));
		    redirect('GenerateBulanan','refresh');
		}
		
		if(isset($_POST['unit'])){
		    $unit = $_POST['unit'];
		}else{
		    $this->session->set_flashdata('msg', show_succ_msg('Mohon Pilih Bulan Terlebih Dahulu', '20px'));
		    redirect('GenerateBulanan','refresh');
		}
		
		$result = $this->postingbulanan->generate($kd_satker,$tahun,$bulan,$jenis,$unit);    
		
		if ($result > 0) {
			$this->session->set_flashdata('msg', show_succ_msg('Data Generate Bukti Potong Berhasil diupdate', '20px'));
		} else {
			$this->session->set_flashdata('msg', show_succ_msg('Data Generate Bukti Potong Gagal diupdate', '20px'));
		}

		redirect('GenerateBulanan','refresh');
	}

}

/* End of file GenerateBulanan.php */
/* Location: ./application/controllers/GenerateBulanan.php */
